{
    "data": [
        {
            "aws_caller_identity": {
                "current": {}
            }
        },
        {
            "aws_iam_policy_document": {
                "aws_iam_role_document": {
                    "statement": [
                        {
                            "actions": [
                                "sts:AssumeRole"
                            ],
                            "condition": {
                                "test": "StringEquals",
                                "values": [
                                    "${var.role_external_id}"
                                ],
                                "variable": "sts:ExternalId"
                            },
                            "effect": "Allow",
                            "principals": {
                                "identifiers": [
                                    "${lookup(local.clumio_iam_role_principal, var.access_via_role_chaining ? \"intermediate_role\" : \"root\", \"\")}"
                                ],
                                "type": "AWS"
                            }
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "aws_support_role_document": {
                    "statement": [
                        {
                            "actions": [
                                "sts:AssumeRole"
                            ],
                            "condition": {
                                "test": "StringEquals",
                                "variable": "sts:ExternalId",
                                "values": [
                                    "${var.role_external_id}"
                                ]
                            },
                            "effect": "Allow",
                            "principals": {
                                "type": "AWS",
                                "identifiers": [
                                    "${lookup(local.clumio_support_role_principal, var.access_via_role_chaining ? \"intermediate_role\" : \"root\", \"\")}"
                                ]
                            }
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_base_policy_document": {
                    "statement": [
                        {
                            "actions": [
                                "iam:ListAccountAliases"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "GetAccountFriendlyName"
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_discover_policy_document": {
                    "dynamic": [
                        {
                            "statement": {
                                "for_each":"${var.is_dynamodb_enabled ? [1] : []}",
                                "content": [
                                    {
                                        "actions": [
                                            "dynamodb:DescribeBackup",
                                            "dynamodb:DescribeContinuousBackups",
                                            "dynamodb:DescribeGlobalTable",
                                            "dynamodb:DescribeGlobalTableSettings",
                                            "dynamodb:DescribeTable",
                                            "dynamodb:DescribeTableReplicaAutoScaling",
                                            "dynamodb:ListBackups",
                                            "dynamodb:ListGlobalTables",
                                            "dynamodb:ListTables",
                                            "dynamodb:ListTagsOfResource"
                                        ],
                                        "effect": "Allow",
                                        "resources": [
                                            "*"
                                        ],
                                        "sid": "DescribeDynamoResources"
                                    }
                                ]
                            }
                        },
                        {
                            "statement": {
                                "for_each":"${var.is_ebs_enabled ? [1] : []}",
                                "content": [
                                    {
                                        "actions": [
                                            "ec2:DescribeImageAttribute",
                                            "ec2:DescribeImages",
                                            "ec2:DescribeInstanceAttribute",
                                            "ec2:DescribeInstanceStatus",
                                            "ec2:DescribeInstances",
                                            "ec2:DescribeInstanceTypes",
                                            "ec2:DescribeInstanceCreditSpecifications",
                                            "ec2:DescribeInstanceTypeOfferings",
                                            "ec2:DescribeTags",
                                            "ec2:DescribeSnapshots",
                                            "ec2:DescribeAvailabilityZones",
                                            "ec2:DescribeSecurityGroups"
                                        ],
                                        "effect": "Allow",
                                        "resources": [
                                            "*"
                                        ],
                                        "sid": "DescribeEc2Resources"
                                    }
                                ]
                            }
                        },
                        {
                            "statement": {
                                "for_each":"${var.is_ebs_enabled ? [1] : []}",
                                "content": [
                                    {
                                        "actions": [
                                            "ec2:DescribeFastSnapshotRestores",
                                            "ec2:DescribeSnapshotAttribute",
                                            "ec2:DescribeSnapshots",
                                            "ec2:DescribeVolumeAttribute",
                                            "ec2:DescribeVolumeStatus",
                                            "ec2:DescribeVolumes",
                                            "ebs:ListChangedBlocks",
                                            "ebs:ListSnapshotBlocks",
                                            "kms:DescribeKey"
                                        ],
                                        "effect": "Allow",
                                        "resources": [
                                            "*"
                                        ],
                                        "sid": "DescribeEbsResources"
                                    }
                                ]
                            }
                        },
                        {
                            "statement": {
                                "for_each":"${var.is_rds_enabled ? [1] : []}",
                                "content": [
                                    {
                                        "actions": [
                                            "rds:DescribeDBClusters",
                                            "rds:DescribeDBClusterSnapshotAttributes",
                                            "rds:DescribeDBClusterSnapshots",
                                            "rds:DescribeDBInstanceAutomatedBackups",
                                            "rds:DescribeDBInstances",
                                            "rds:DescribeDBSnapshotAttributes",
                                            "rds:DescribeDBSnapshots",
                                            "rds:DescribeGlobalClusters",
                                            "rds:ListTagsForResource",
                                            "rds:DescribeOptionGroups",
                                            "rds:DescribeOptionGroupOptions",
                                            "cloudwatch:GetMetricStatistics"
                                        ],
                                        "effect": "Allow",
                                        "resources": [
                                            "*"
                                        ],
                                        "sid": "DescribeRdsResources"
                                    }
                                ]
                            }
                        },
                        {
                            "statement": {
                                "for_each":"${var.is_s3_enabled ? [1] : []}",
                                "content": [
                                    {
                                        "actions": [
                                            "s3:ListAllMyBuckets",
                                            "s3:GetBucketLocation",
                                            "s3:GetEncryptionConfiguration",
                                            "s3:GetBucketVersioning",
                                            "s3:GetBucketPolicy",
                                            "s3:GetBucketTagging",
                                            "s3:GetReplicationConfiguration",
                                            "s3:GetInventoryConfiguration",
                                            "s3:PutInventoryConfiguration",
                                            "s3:ListBucket*",
                                            "s3:GetObject*",
                                            "s3:PutBucketNotification",
                                            "s3:GetBucketLogging",
                                            "backup:ListProtectedResources",
                                            "s3:GetLifecycleConfiguration",
                                            "s3:GetBucketLogging"
                                        ],
                                        "effect": "Allow",
                                        "resources": [
                                            "*"
                                        ],
                                        "sid": "DescribeS3Resources"
                                    }
                                ]
                            }
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_drift_detect_policy_document": {
                    "statement": [
                        {
                            "actions": [
                                "iam:GetServiceLinkedRoleDeletionStatus",
                                "iam:ListInstanceProfilesForRole",
                                "iam:SimulatePrincipalPolicy",
                                "iam:GetContextKeysForPrincipalPolicy",
                                "iam:ListAttachedRolePolicies",
                                "iam:ListRolePolicies",
                                "iam:ListRoleTags",
                                "iam:GetRolePolicy",
                                "iam:GetRole",
                                "sns:GetTopicAttributes",
                                "sns:ListSubscriptionsByTopic",
                                "sns:ListTagsForResource",
                                "events:DescribeEventBus",
                                "events:ListTagsForResource",
                                "events:DescribeRule",
                                "events:ListTargetsByRule"
                            ],
                            "effect": "Allow",
                            "resources": "${compact([\"${aws_iam_role.clumio_iam_role.arn}\", \"${aws_sns_topic.clumio_event_pub.arn}\", \"${aws_cloudwatch_event_rule.clumio_tag_event_rule.arn}\", \"${var.is_rds_enabled ? aws_cloudwatch_event_rule.clumio_rds_cloudwatch_event_rule[0].arn : \"\"}\", \"${var.is_rds_enabled ? aws_cloudwatch_event_rule.clumio_rds_cloudtrail_event_rule[0].arn : \"\"}\", \"${var.is_dynamodb_enabled ? aws_cloudwatch_event_rule.clumio_dynamo_cloudtrail_event_rule[0].arn : \"\"}\", \"${var.is_ebs_enabled ? aws_cloudwatch_event_rule.clumio_ebs_cloudwatch_event_rule[0].arn : \"\"}\", \"${var.is_ebs_enabled ? aws_cloudwatch_event_rule.clumio_ec2_cloudwatch_event_rule[0].arn : \"\"}\", \"${var.is_ebs_enabled ? aws_cloudwatch_event_rule.clumio_ebs_cloudtrail_event_rule[0].arn : \"\"}\", \"${var.is_ebs_enabled ? aws_cloudwatch_event_rule.clumio_ec2_cloudtrail_event_rule[0].arn : \"\"}\" ])}",
                            "sid": "ReflectOnClumioCfnStack"
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_dynamodb_policy_document": {
                    "statement": [
                        {
                            "actions": [
                                "dynamodb:CreateTable",
                                "dynamodb:CreateTableReplica",
                                "dynamodb:ExportTableToPointInTime",
                                "dynamodb:UpdateTableReplicaAutoScaling"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:${data.aws_partition.current.partition}:dynamodb:*:${var.aws_account_id}:table/*"
                            ],
                            "sid": "ClumioDynamoDbSecureVaultTableActions"
                        },
                        {
                            "actions": [
                                "dynamodb:DescribeStream",
                                "dynamodb:GetRecords",
                                "dynamodb:GetShardIterator"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:${data.aws_partition.current.partition}:dynamodb:*:${var.aws_account_id}:table/*/stream/*"
                            ],
                            "sid": "ClumioDynamoDbSecureVaultStreamActions"
                        },
                        {
                            "actions": [
                                "dynamodb:DescribeExport"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:${data.aws_partition.current.partition}:dynamodb:*:${var.aws_account_id}:table/*/export/*"
                            ],
                            "sid": "ClumioDynamoDbSecureVaultExportActions"
                        },
                        {
                            "actions": [
                                "s3:AbortMultipartUpload",
                                "s3:PutObject",
                                "s3:PutObjectAcl"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:aws:s3:::clumio-ddb-export-*/*"
                            ],
                            "sid": "ClumioDynamoDbSecureVaultExportS3Actions"
                        },
                        {
                            "actions": [
                                "dynamodb:ImportTable",
                                "dynamodb:DescribeImport"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:${data.aws_partition.current.partition}:dynamodb:*:${var.aws_account_id}:table/*"
                            ],
                            "sid": "ClumioDynamoDbSecureVaultImportActions"
                        },
                        {
                            "actions": [
                                "s3:GetObject",
                                "s3:ListBucket"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:aws:s3:::clumio-ddb-export-*/*",
                                "arn:aws:s3:::clumio-ddb-export-*"
                            ],
                            "sid": "ClumioDynamoDbSecureVaultImportFromS3Actions"
                        },
                        {
                            "actions": [
                                "logs:CreateLogGroup",
                                "logs:CreateLogStream",
                                "logs:DescribeLogGroups",
                                "logs:DescribeLogStreams",
                                "logs:PutLogEvents",
                                "logs:PutRetentionPolicy"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:${data.aws_partition.current.partition}:logs:*:${var.aws_account_id}:log-group:/aws-dynamodb/imports:*",
                                "arn:${data.aws_partition.current.partition}:logs:*:${var.aws_account_id}:log-group::log-stream:*"
                            ],
                            "sid": "ClumioDynamoDbSecureVaultCloudWatchActions"
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_ec2_mssql_protect_policy_document": {
                    "count": "${var.is_ec2_mssql_enabled ? 1 : 0}",
                    "statement": [
                        {
                            "actions": [
                                "ssm:GetCommandInvocation",
                                "ec2:DescribeInstances",
                                "iam:GetInstanceProfile"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "DescribeSSMAndEC2Resources"
                        },
                        {
                            "actions": [
                                "ssm:SendCommand"
                            ],
                            "condition": {
                                "test": "StringEquals",
                                "values": [
                                    "Clumio"
                                ],
                                "variable": "aws:ResourceTag/Vendor"
                            },
                            "effect": "Allow",
                            "resources": [
                                "arn:aws:ec2:${var.aws_region}:${var.aws_account_id}:instance/*"
                            ],
                            "sid": "ClumioDataProtectionSSMCmd"
                        },
                        {
                            "actions": [
                                "ssm:CancelCommand"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:aws:ssm:${var.aws_region}:${var.aws_account_id}:*"
                            ],
                            "sid": "ClumioDataProtectionSSMCancelCmd"
                        },
                        {
                            "actions": [
                                "ssm:SendCommand"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:aws:ssm:${var.aws_region}::document/AWS-RunPowerShellScript"
                            ],
                            "sid": "ClumioDataProtectionSSMCmdDoc"
                        },
                        {
                            "actions": [
                                "iam:GetRole",
                                "iam:PassRole"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "${aws_iam_role.clumio_ssm_notification_role[0].arn}"
                            ],
                            "sid": "ClumioSSMPassRole"
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_ec2_mssql_ssm_instance_policy_document": {
                    "statement": [
                        {
                            "actions": [
                                "ssm:DescribeAssociation",
                                "ssm:GetDeployablePatchSnapshotForInstance",
                                "ssm:GetDocument",
                                "ssm:DescribeDocument",
                                "ssm:GetManifest",
                                "ssm:GetParameter",
                                "ssm:GetParameters",
                                "ssm:ListAssociations",
                                "ssm:ListInstanceAssociations",
                                "ssm:PutInventory",
                                "ssm:PutComplianceItems",
                                "ssm:PutConfigurePackageResult",
                                "ssm:UpdateAssociationStatus",
                                "ssm:UpdateInstanceAssociationStatus",
                                "ssm:UpdateInstanceInformation"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "SSMAccess"
                        },
                        {
                            "actions": [
                                "ssmmessages:CreateControlChannel",
                                "ssmmessages:CreateDataChannel",
                                "ssmmessages:OpenControlChannel",
                                "ssmmessages:OpenDataChannel"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "SSMControlChannels"
                        },
                        {
                            "actions": [
                                "ec2messages:AcknowledgeMessage",
                                "ec2messages:DeleteMessage",
                                "ec2messages:FailMessage",
                                "ec2messages:GetEndpoint",
                                "ec2messages:GetMessages",
                                "ec2messages:SendReply"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "EC2Messages"
                        },
                        {
                            "actions": [
                                "s3:PutObject",
                                "s3:GetObject"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "S3Permissions"
                        },
                        {
                            "actions": [
                                "logs:CreateLogGroup",
                                "logs:CreateLogStream",
                                "logs:DescribeLogGroups",
                                "logs:DescribeLogStreams",
                                "logs:PutLogEvents"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "CloudWatchPermissions"
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_ec2_mssql_ssm_instance_role_v2_document": {
                    "statement": [
                        {
                            "actions": [
                                "sts:AssumeRole"
                            ],
                            "condition": {
                                "test": "StringEquals",
                                "values": [
                                    "${var.role_external_id}"
                                ],
                                "variable": "sts:ExternalId"
                            },
                            "effect": "Allow",
                            "principals": {
                                "identifiers": [
                                    "ec2.amazonaws.com"
                                ],
                                "type": "Service"
                            }
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_ec2_protect_managed_policy_document": {
                    "statement": [
                        {
                            "actions": [
                                "ec2:CreateSnapshots",
                                "ec2:CreateSnapshot",
                                "ec2:CreateTags",
                                "ec2:DeleteTags",
                                "ec2:DeleteSnapshot",
                                "ec2:CreateVolume",
                                "ec2:DeleteVolume",
                                "ec2:AttachVolume",
                                "ec2:DetachVolume",
                                "ec2:StartInstances",
                                "ec2:StopInstances",
                                "ec2:DeleteNetworkInterface",
                                "ec2:AssociateAddress",
                                "ec2:DisassociateAddress",
                                "ec2:DescribeVpcs",
                                "ec2:DescribeAddresses",
                                "ec2:DescribeNetworkInterfaces",
                                "ec2:DescribeKeyPairs",
                                "ec2:DescribeElasticGpus",
                                "ec2:DescribeSubnets",
                                "iam:GetRole",
                                "iam:ListRoles",
                                "iam:GetInstanceProfile",
                                "iam:ListInstanceProfiles",
                                "elastic-inference:DescribeAccelerators",
                                "elastic-inference:DescribeAcceleratorOfferings",
                                "ec2:DescribeCapacityReservations",
                                "ec2:RegisterImage",
                                "ec2:DeregisterImage"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "GeneralDataProtectionEC2"
                        },
                        {
                            "actions": [
                                "ec2:TerminateInstances",
                                "ec2:RunInstances"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "ClumioDataProtectionVpc"
                        },
                        {
                            "actions": [
                                "iam:PassRole"
                            ],
                            "condition": {
                                "test": "StringLike",
                                "values": [
                                    "ec2.amazonaws.com*"
                                ],
                                "variable": "iam:PassedToService"
                            },
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "AssignClumioDataProtectionInstanceRole"
                        },
                        {
                            "actions": [
                                "ebs:ListChangedBlocks",
                                "ebs:ListSnapshotBlocks",
                                "ebs:GetSnapshotBlock",
                                "ebs:PutSnapshotBlock",
                                "ebs:StartSnapshot",
                                "ebs:CompleteSnapshot"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:aws:ec2:*::snapshot/*"
                            ],
                            "sid": "ClumioDataProtectionEBSDirect"
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_event_pub_policy_document": {
                    "statement": [
                        {
                            "actions": [
                                "SNS:Publish"
                            ],
                            "condition": {
                                "test": "StringEquals",
                                "values": [
                                    "${var.aws_account_id}"
                                ],
                                "variable": "AWS:SourceOwner"
                            },
                            "effect": "Allow",
                            "principals": {
                                "identifiers": [
                                    "*"
                                ],
                                "type": "AWS"
                            },
                            "resources": [
                                "${aws_sns_topic.clumio_event_pub.arn}"
                            ],
                            "sid": "__pub_statement"
                        },
                        {
                            "actions": [
                                "SNS:Subscribe"
                            ],
                            "effect": "Allow",
                            "principals": {
                                "identifiers": [
                                    "arn:aws:iam::${var.clumio_aws_account_id}:root"
                                ],
                                "type": "AWS"
                            },
                            "resources": [
                                "${aws_sns_topic.clumio_event_pub.arn}"
                            ],
                            "sid": "__sub_statement"
                        },
                        {
                            "actions": [
                                "SNS:ListSubscriptionsByTopic"
                            ],
                            "effect": "Allow",
                            "principals": {
                                "identifiers": [
                                    "arn:aws:iam::${var.clumio_aws_account_id}:root"
                                ],
                                "type": "AWS"
                            },
                            "resources": [
                                "${aws_sns_topic.clumio_event_pub.arn}"
                            ],
                            "sid": "__desc_sub_statement"
                        },
                        {
                            "actions": [
                                "SNS:Publish"
                            ],
                            "effect": "Allow",
                            "principals": {
                                "identifiers": [
                                    "events.amazonaws.com"
                                ],
                                "type": "Service"
                            },
                            "resources": [
                                "${aws_sns_topic.clumio_event_pub.arn}"
                            ],
                            "sid": "AWSEvents_ClumioInventoryRule_${var.clumio_token}_clumio-publish"
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_iam_permissions_boundary_document": {
                    "count": "${var.is_dynamodb_enabled ? 1 : 0}",
                    "statement": [
                        {
                            "actions": [
                                "dynamodb:BatchWriteItem",
                                "dynamodb:DescribeTable"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:${data.aws_partition.current.partition}:dynamodb:*:${var.aws_account_id}:table/*"
                            ],
                            "sid": "AllowClumioDynamoDbSecureVaultAccess"
                        },
                        {
                            "actions": [
                                "kms:Decrypt",
                                "kms:DescribeKey",
                                "kms:Encrypt",
                                "kms:GenerateDataKey*",
                                "kms:ReEncrypt*"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:${data.aws_partition.current.partition}:kms:*:*:key/*"
                            ],
                            "sid": "AllowClumioDynamoDbSecureVaultKmsAccess"
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_iam_role_policy_document": {
                    "count": "${var.is_dynamodb_enabled ? 1 : 0}",
                    "statement": [
                        {
                            "actions": [
                                "iam:CreateRole",
                                "iam:AttachRolePolicy"
                            ],
                            "condition": {
                                "test": "StringEquals",
                                "values": [
                                    "${aws_iam_policy.clumio_iam_permissions_boundary[0].arn}"
                                ],
                                "variable": "iam:PermissionsBoundary"
                            },
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "AllowCreateRole"
                        },
                        {
                            "actions": [
                                "iam:DetachRolePolicy",
                                "iam:DeleteRole"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:${data.aws_partition.current.partition}:iam::${var.aws_account_id}:role/clumio/*"
                            ],
                            "sid": "AllowDeleteRole"
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_kms_managed_policy_document": {
                    "statement": [
                        {
                            "actions": [
                                "kms:DescribeKey",
                                "kms:Encrypt",
                                "kms:Decrypt",
                                "kms:ReEncrypt*",
                                "kms:GenerateDataKey*",
                                "kms:DescribeKey",
                                "kms:CreateGrant"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "RequiredKmsActions"
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_rds_protect_policy_document": {
                    "statement": [
                        {
                            "actions": [
                                "rds:DescribeDBSubnetGroups",
                                "rds:CreateDBInstance",
                                "rds:CreateDBSnapshot",
                                "rds:CreateDBClusterSnapshot",
                                "rds:RestoreDBInstanceFromDBSnapshot",
                                "rds:RestoreDBInstanceToPointInTime",
                                "rds:RestoreDBClusterFromSnapshot",
                                "rds:RestoreDBClusterToPointInTime",
                                "rds:ModifyDBCluster",
                                "rds:ModifyDBInstance",
                                "rds:ModifyDBClusterSnapshotAttribute",
                                "rds:ModifyDBSnapshotAttribute",
                                "rds:CopyDBClusterSnapshot",
                                "rds:CopyDBSnapshot",
                                "rds:RemoveTagsFromResource",
                                "rds:ListTagsForResource",
                                "rds:AddTagsToResource",
                                "rds:CreateOptionGroup",
                                "rds:CreateDBParameterGroup",
                                "rds:ModifyOptionGroup",
                                "ec2:DescribeSecurityGroups"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "GeneralDataProtectionRDS"
                        },
                        {
                            "actions": [
                                "rds:DeleteDBCluster"
                            ],
                            "condition": {
                                "test": "StringLike",
                                "values": [
                                    "*"
                                ],
                                "variable": "rds:cluster-tag/clumio.restore.tag"
                            },
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "RDSClusterCleanup"
                        },
                        {
                            "actions": [
                                "rds:DeleteDBInstance"
                            ],
                            "condition": {
                                "test": "StringLike",
                                "values": [
                                    "*"
                                ],
                                "variable": "rds:db-tag/clumio.restore.tag"
                            },
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "RDSInstanceCleanup"
                        },
                        {
                            "actions": [
                                "rds:DeleteDBClusterSnapshot"
                            ],
                            "condition": {
                                "test": "StringLike",
                                "values": [
                                    "*"
                                ],
                                "variable": "rds:cluster-snapshot-tag/clumio.rds.snapshot.tag"
                            },
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "RDSClusterSnapshotCleanup"
                        },
                        {
                            "actions": [
                                "rds:DeleteDBSnapshot"
                            ],
                            "condition": {
                                "test": "StringLike",
                                "values": [
                                    "*"
                                ],
                                "variable": "rds:snapshot-tag/clumio.rds.snapshot.tag"
                            },
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "RDSInstanceSnapshotCleanup"
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_s3_continuous_backup_event_bridge_policy_document": {
                    "statement": [
                        {
                            "actions": [
                                "events:PutEvents"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:aws:events:*:*:event-bus/clumio-s3-event-bus-*"
                            ],
                            "sid": "AllowPutEvents"
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_s3_continuous_backup_event_bridge_role_document": {
                    "statement": [
                        {
                            "actions": [
                                "sts:AssumeRole"
                            ],
                            "effect": "Allow",
                            "principals": {
                                "identifiers": [
                                    "events.amazonaws.com"
                                ],
                                "type": "Service"
                            },
                            "sid": "AllowEventBridgeAssumeRole"
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_s3_protect_policy_document": {
		    "count": "${var.is_s3_enabled ? 1 : 0}",
                    "statement": [
                        {
                            "actions": [
                                "cloudwatch:GetMetricStatistics"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "GetS3CloudwatchMetrics"
                        },
                        {
                            "actions": [
                                "s3:ListBucket",
                                "s3:PutObject*"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:aws:s3:::clumio-s3-backup*",
                                "arn:aws:s3:::clumio-s3-backup*/*"
                            ],
                            "sid": "AllowS3CopyToClumio"
                        },
                        {
                            "actions": [
                                "s3:PutObject*",
                                "s3:DeleteObject"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "AllowS3PutForRestores"
                        },
                        {
                            "actions": [
                                "organizations:DescribeOrganization"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "AllowDescribeOrganization"
                        },
                        {
                            "actions": [
                                "events:DescribeRule",
                                "events:PutRule",
                                "events:DeleteRule",
                                "events:PutTargets",
                                "events:RemoveTargets",
                                "events:ListTargetsByRule"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:aws:events:*:${data.aws_caller_identity.current.account_id}:rule/clumio-s3-event-rule-*"
                            ],
                            "sid": "AllowS3EventRuleUpdate"
                        },
                        {
                            "actions": [
                                "events:PutEvents"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:aws:events:*:*:event-bus/clumio-s3-event-bus-*"
                            ],
                            "sid": "AllowS3EventFwdToClumio"
                        },
                        {
                            "actions": [
                                "iam:PassRole"
                            ],
                            "condition": {
                                "test": "StringEquals",
                                "values": [
                                    "events.amazonaws.com"
                                ],
                                "variable": "iam:PassedToService"
                            },
                            "effect": "Allow",
                            "resources": [
                                "${aws_iam_role.clumio_s3_continuous_backup_event_bridge_role[0].arn}"
                            ],
                            "sid": "AllowS3ContinuousBackupRolePassToEventBridge"
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_ssm_notification_policy_document": {
                    "statement": [
                        {
                            "actions": [
                                "sns:Publish"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:aws:sns:${var.aws_region}:${var.clumio_aws_account_id}:ClumioSSMTopic_${var.aws_account_id}_${var.aws_region}_*"
                            ],
                            "sid": "SSMAccess"
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_ssm_notification_role_document": {
                    "statement": [
                        {
                            "actions": [
                                "sts:AssumeRole"
                            ],
                            "effect": "Allow",
                            "principals": {
                                "identifiers": [
                                    "ssm.amazonaws.com"
                                ],
                                "type": "Service"
                            }
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_support_policy_document": {
                    "statement": [
                        {
                            "actions": [
                                "support:*"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "AllowClumioSupportAccess"
                        },
                        {
                            "actions": [
                                "support:ResolveCase"
                            ],
                            "effect": "Deny",
                            "resources": [
                                "*"
                            ],
                            "sid": "DenyClumioSupportResolution"
                        }
                    ]
                }
            }
        },
        {
            "aws_iam_policy_document": {
                "clumio_warm_protect_dynamodb_policy_document": {
                    "statement": [
                        {
                            "actions": [
                                "kms:CreateGrant",
                                "kms:Decrypt",
                                "kms:DescribeKey",
                                "kms:Encrypt",
                                "kms:GenerateDataKey",
                                "kms:ReEncrypt*"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:${data.aws_partition.current.partition}:kms:*:*:key/*"
                            ],
                            "sid": "ClumioWarmProtectDynamoDbKmsActions"
                        },
                        {
                            "actions": [
                                "dynamodb:BatchWriteItem",
                                "dynamodb:CreateBackup",
                                "dynamodb:DeleteItem",
                                "dynamodb:DeleteTable",
                                "dynamodb:DescribeTable",
                                "dynamodb:DescribeContinuousBackups",
                                "dynamodb:DescribeTimeToLive",
                                "dynamodb:GetItem",
                                "dynamodb:ListTagsOfResource",
                                "dynamodb:PutItem",
                                "dynamodb:Query",
                                "dynamodb:RestoreTableFromBackup",
                                "dynamodb:RestoreTableToPointInTime",
                                "dynamodb:Scan",
                                "dynamodb:TagResource",
                                "dynamodb:UntagResource",
                                "dynamodb:UpdateContinuousBackups",
                                "dynamodb:UpdateItem",
                                "dynamodb:UpdateTable",
                                "dynamodb:UpdateTimeToLive"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:${data.aws_partition.current.partition}:dynamodb:*:${var.aws_account_id}:table/*"
                            ],
                            "sid": "ClumioWarmProtectDynamoDbTableActions"
                        },
                        {
                            "actions": [
                                "dynamodb:DeleteBackup",
                                "dynamodb:DescribeBackup"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:${data.aws_partition.current.partition}:dynamodb:*:${var.aws_account_id}:table/*/backup/*"
                            ],
                            "sid": "ClumioWarmProtectDynamoDbBackupActions"
                        },
                        {
                            "actions": [
                                "dynamodb:ListBackups"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "ClumioWarmProtectDynamoDbMiscActions"
                        },
                        {
                            "actions": [
                                "application-autoscaling:DescribeScalableTargets",
                                "application-autoscaling:DescribeScalingPolicies",
                                "application-autoscaling:PutScalingPolicy",
                                "application-autoscaling:RegisterScalableTarget"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "*"
                            ],
                            "sid": "ClumioWarmProtectDynamoDbAutoScalingActions"
                        },
                        {
                            "actions": [
                                "iam:PassRole"
                            ],
                            "effect": "Allow",
                            "resources": [
                                "arn:aws:iam::${var.aws_account_id}:role/aws-service-role/dynamodb.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_DynamoDBTable"
                            ],
                            "sid": "ClumioWarmProtectDynamoDbAutoScalingRole"
                        },
                        {
                            "actions": [
                                "iam:CreateServiceLinkedRole"
                            ],
                            "condition": {
                                "test": "StringLike",
                                "values": [
                                    "dynamodb.application-autoscaling.amazonaws.com"
                                ],
                                "variable": "iam:AWSServiceName"
                            },
                            "effect": "Allow",
                            "resources": [
                                "arn:aws:iam::${var.aws_account_id}:role/aws-service-role/dynamodb.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_DynamoDBTable"
                            ],
                            "sid": "ClumioWarmProtectCreateDynamoDbAutoScalingRole"
                        }
                    ]
                }
            }
        },
        {
            "aws_partition": {
                "current": {}
            }
        },
        {
            "aws_region": {
                "current": {}
            }
        }
    ],
    "locals": [
        {
            "region_map": {
                "ap-east-1": "ae-1",
                "ap-northeast-1": "ane-1",
                "ap-northeast-2": "ane-2",
                "ap-northeast-3": "ane-3",
                "ap-south-1": "as-1",
                "ap-southeast-1": "ase-1",
                "ap-southeast-2": "ase-2",
                "ca-central-1": "cc-1",
                "eu-central-1": "ec-1",
                "eu-north-1": "en-1",
                "eu-west-1": "ew-1",
                "eu-west-2": "ew-2",
                "eu-west-3": "ew-3",
                "me-south-1": "ms-1",
                "sa-east-1": "se-1",
                "us-east-1": "ue-1",
                "us-east-2": "ue-2",
                "us-west-1": "uw-1",
                "us-west-2": "uw-2"
            },
            "clumio_iam_role_principal": {
                "root": "arn:aws:iam::${var.clumio_aws_account_id}:root",
                "intermediate_role": "arn:aws:iam::${var.clumio_aws_account_id}:role/ClumioCustomerProtectRole"
            },
            "clumio_support_role_principal": {
                "root": "arn:aws:iam::${var.clumio_aws_account_id}:root",
                "intermediate_role": "arn:aws:iam::${var.clumio_aws_account_id}:role/ClumioCustomerSupportRole"
            }
        }
    ],
    "resource": [
        {
            "aws_cloudwatch_event_rule": {
                "clumio_dynamo_cloudtrail_event_rule": {
                    "count": "${var.is_dynamodb_enabled ? 1 : 0}",
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "description": "Watches for resource changes in DynamoDB (CloudTrail).",
                    "event_pattern": "{\"source\": [\"aws.dynamodb\"],\"detail-type\": [\"AWS API Call via CloudTrail\"],\"detail\": {\"eventName\": [\"CreateTable\",\"DeleteTable\",\"RestoreTableFromBackup\",\"RestoreTableToPointInTime\",\"UpdateTable\",\"UpdateContinuousBackups\",\"CreateBackup\",\"DeleteBackup\",\"CreateGlobalTable\",\"UpdateGlobalTable\",\"UpdateGlobalTableSettings\"],\"errorCode\": [{\"exists\": false}]}}",
                    "name": "ClumioDynamoCloudtrailRule_${var.clumio_token}"
                }
            }
        },
        {
            "aws_cloudwatch_event_rule": {
                "clumio_ebs_cloudtrail_event_rule": {
                    "count": "${var.is_ebs_enabled ? 1 : 0}",
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "description": "Watches for resource changes in EBS (CloudTrail).",
                    "event_pattern": "{\"source\": [\"aws.ec2\"],\"detail-type\": [\"AWS API Call via CloudTrail\"],\"detail\": {\"eventName\": [\"DeleteSnapshot\"],\"errorCode\": [{\"exists\": false}]}}",
                    "name": "ClumioEBSCloudtrailRule_${var.clumio_token}"
                }
            }
        },
        {
            "aws_cloudwatch_event_rule": {
                "clumio_ebs_cloudwatch_event_rule": {
                    "count": "${var.is_ebs_enabled ? 1 : 0}",
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "description": "Watches for resource changes in EBS (CloudWatch).",
                    "event_pattern": "{\"source\": [\"aws.ec2\"],\"detail-type\": [\"EBS Volume Notification\", \"EBS Snapshot Notification\"],\"detail\": {\"event\": [\"createVolume\",\"modifyVolume\",\"deleteVolume\",\"createSnapshot\",\"createSnapshots\",\"copySnapshot\",\"shareSnapshot\"]}}",
                    "name": "ClumioEBSCloudwatchRule_${var.clumio_token}"
                }
            }
        },
        {
            "aws_cloudwatch_event_rule": {
                "clumio_ec2_cloudtrail_event_rule": {
                    "count": "${var.is_ebs_enabled ? 1 : 0}",
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "description": "Watches for resource changes in EC2 (CloudTrail).",
                    "event_pattern": "{ \"source\": [\"aws.ec2\"], \"detail-type\": [\"AWS API Call via CloudTrail\"], \"detail\": { \"eventName\": [ \"CreateImage\", \"DeregisterImage\", \"DeleteImage\", \"RegisterImage\", \"CopyImage\", \"AssociateIamInstanceProfile\", \"DisassociateIamInstanceProfile\", \"ReplaceIamInstanceProfileAssociation\", \"AttachVolume\", \"DetachVolume\" ], \"errorCode\": [{\"exists\": false}] } }",
                    "name": "ClumioEC2CloudtrailRule_${var.clumio_token}"
                }
            }
        },
        {
            "aws_cloudwatch_event_rule": {
                "clumio_ec2_cloudwatch_event_rule": {
                    "count": "${var.is_ebs_enabled ? 1 : 0}",
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "description": "Watches for resource changes in EC2 (CloudWatch).",
                    "event_pattern": "{\"source\": [\"aws.ec2\"], \"detail-type\": [\"EC2 Instance State-change Notification\"], \"detail\": {\"state\": [\"running\", \"stopped\", \"terminated\"]}}",
                    "name": "ClumioEC2CloudwatchRule_${var.clumio_token}"
                }
            }
        },
        {
            "aws_cloudwatch_event_rule": {
                "clumio_rds_cloudtrail_event_rule": {
                    "count": "${var.is_rds_enabled ? 1 : 0}",
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "description": "Watches for resource changes in RDS (CloudTrail).",
                    "event_pattern": "{\"source\": [\"aws.ec2\"],\"detail-type\": [\"AWS API Call via CloudTrail\"],\"detail\": {\"eventName\": [\"DeleteDBSnapshot\",\"DeleteDBClusterSnapshot\",\"CopyDBClusterSnapshot\",\"CopyDBSnapshot\",\"CreateDBCluster\",\"DeleteDBCluster\"],\"errorCode\": [{\"exists\": false}]}}",
                    "name": "ClumioRDSCloudtrailRule_${var.clumio_token}"
                }
            }
        },
        {
            "aws_cloudwatch_event_rule": {
                "clumio_rds_cloudwatch_event_rule": {
                    "count": "${var.is_rds_enabled ? 1 : 0}",
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "description": "Watches for resource changes in RDS (CloudWatch).",
                    "event_pattern": "{\"source\": [\"aws.rds\"], \"detail-type\": [\"RDS DB Instance Event\",\"RDS DB Snapshot Event\",\"RDS DB Cluster Event\",\"RDS DB Cluster Snapshot Event\" ], \"detail\": {\"SourceType\": [\"DB_INSTANCE\", \"SNAPSHOT\", \"CLUSTER\", \"CLUSTER_SNAPSHOT\"] } }",
                    "name": "ClumioRDSCloudwatchRule_${var.clumio_token}"
                }
            }
        },
        {
            "aws_cloudwatch_event_rule": {
                "clumio_s3_cloudtrail_event_rule": {
                    "count": "${var.is_s3_enabled ? 1 : 0}",
                    "depends_on": [
                        "time_sleep.wait_before_create",
                        "time_sleep.wait_10_seconds_before_creating_clumio_s3_cloudtrail_event_rule"
                    ],
                    "description": "Watches for bucket-level resource changes in S3 (CloudTrail).",
                    "event_pattern": "{\"source\": [\"aws.s3\"], \"detail-type\": [\"AWS API Call via CloudTrail\"], \"detail\": {\"eventName\": [\"CreateBucket\", \"DeleteBucket\", \"DeleteBucketLifecycle\", \"DeleteBucketPolicy\", \"DeleteBucketReplication\", \"DeleteBucketTagging\", \"DeleteBucketEncryption\", \"DeleteBucketPublicAccessBlock\", \"PutBucketAcl\", \"PutBucketLifecycle\", \"PutBucketPolicy\", \"PutBucketReplication\", \"PutBucketTagging\", \"PutBucketVersioning\", \"PutBucketEncryption\", \"PutBucketPublicAccessBlock\"], \"errorCode\": [{\"exists\": false}]}}",
                    "name": "ClumioS3CloudtrailEventRule_${var.clumio_token}"
                }
            }
        },
        {
            "aws_cloudwatch_event_rule": {
                "clumio_tag_event_rule": {
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "description": "Watches for tag changes",
                    "event_pattern": "{\"detail\":{\"service\":[\"dynamodb\",\"ec2\",\"ebs\"]},\"source\":[\"aws.tag\"]}",
                    "name": "ClumioTagCloudwatchRule_${var.clumio_token}"
                }
            }
        },
        {
            "aws_cloudwatch_event_target": {
                "clumio_dynamo_cloudtrail_event_rule_target": {
                    "arn": "${aws_sns_topic.clumio_event_pub.arn}",
                    "count": "${var.is_dynamodb_enabled ? 1 : 0}",
                    "rule": "${aws_cloudwatch_event_rule.clumio_dynamo_cloudtrail_event_rule[0].name}",
                    "target_id": "clumio-dynamo-ctrail-publish"
                }
            }
        },
        {
            "aws_cloudwatch_event_target": {
                "clumio_ebs_cloudtrail_event_rule_target": {
                    "arn": "${aws_sns_topic.clumio_event_pub.arn}",
                    "count": "${var.is_ebs_enabled ? 1 : 0}",
                    "rule": "${aws_cloudwatch_event_rule.clumio_ebs_cloudtrail_event_rule[0].name}",
                    "target_id": "clumio-ebs-ctrail-publish"
                }
            }
        },
        {
            "aws_cloudwatch_event_target": {
                "clumio_ebs_cloudwatch_event_rule_target": {
                    "arn": "${aws_sns_topic.clumio_event_pub.arn}",
                    "count": "${var.is_ebs_enabled ? 1 : 0}",
                    "rule": "${aws_cloudwatch_event_rule.clumio_ebs_cloudwatch_event_rule[0].name}",
                    "target_id": "clumio-ebs-cwatch-publish"
                }
            }
        },
        {
            "aws_cloudwatch_event_target": {
                "clumio_ec2_cloudtrail_event_rule_target": {
                    "arn": "${aws_sns_topic.clumio_event_pub.arn}",
                    "count": "${var.is_ebs_enabled ? 1 : 0}",
                    "rule": "${aws_cloudwatch_event_rule.clumio_ec2_cloudtrail_event_rule[0].name}",
                    "target_id": "clumio-ec2-ctrail-publish"
                }
            }
        },
        {
            "aws_cloudwatch_event_target": {
                "clumio_ec2_cloudwatch_event_rule_target": {
                    "arn": "${aws_sns_topic.clumio_event_pub.arn}",
                    "count": "${var.is_ebs_enabled ? 1 : 0}",
                    "rule": "${aws_cloudwatch_event_rule.clumio_ec2_cloudwatch_event_rule[0].name}",
                    "target_id": "clumio-ec2-cwatch-publish"
                }
            }
        },
        {
            "aws_cloudwatch_event_target": {
                "clumio_rds_cloudtrail_event_rule_target": {
                    "count": "${var.is_rds_enabled ? 1 : 0}",
                    "arn": "${aws_sns_topic.clumio_event_pub.arn}",
                    "rule": "${aws_cloudwatch_event_rule.clumio_rds_cloudtrail_event_rule[0].name}",
                    "target_id": "clumio-rds-ctrail-publish"
                }
            }
        },
        {
            "aws_cloudwatch_event_target": {
                "clumio_rds_cloudwatch_event_rule_target": {
                    "count": "${var.is_rds_enabled ? 1 : 0}",
                    "arn": "${aws_sns_topic.clumio_event_pub.arn}",
                    "rule": "${aws_cloudwatch_event_rule.clumio_rds_cloudwatch_event_rule[0].name}",
                    "target_id": "clumio-rds-cwatch-publish"
                }
            }
        },
        {
            "aws_cloudwatch_event_target": {
                "clumio_s3_cloudtrail_event_rule_target": {
                    "arn": "${aws_sns_topic.clumio_event_pub.arn}",
                    "count": "${var.is_s3_enabled ? 1 : 0}",
                    "rule": "${aws_cloudwatch_event_rule.clumio_s3_cloudtrail_event_rule[0].name}",
                    "target_id": "clumio-s3-ctrail-publish"
                }
            }
        },
        {
            "aws_cloudwatch_event_target": {
                "clumio_tag_event_rule_target": {
                    "arn": "${aws_sns_topic.clumio_event_pub.arn}",
                    "rule": "${aws_cloudwatch_event_rule.clumio_tag_event_rule.name}",
                    "target_id": "clumio-publish"
                }
            }
        },
        {
            "aws_iam_instance_profile": {
                "clumio_ec2_mssql_ssm_instance_profile": {
                    "count": "${var.is_ec2_mssql_enabled ? 1 : 0}",
                    "name": "Clumio-SSM-IP-${var.aws_region}-${var.clumio_token}",
                    "path": "${var.path}",
                    "role": "${aws_iam_role.clumio_ec2_mssql_ssm_instance_role_v2[0].name}"
                }
            }
        },
        {
            "aws_iam_policy": {
                "clumio_discover_policy": {
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "name": "ClumioDiscoverPolicy-${var.aws_region}-${var.clumio_token}",
                    "path": "${var.path}",
                    "policy": "${data.aws_iam_policy_document.clumio_discover_policy_document.json}"
                }
            }
        },
        {
            "aws_iam_policy": {
                "clumio_dynamodb_policy": {
                    "count": "${var.is_dynamodb_enabled ? 1 : 0}",
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "description": "Grants access to Clumio for DynamoDB SecureVault.",
                    "name": "ClumioDynamoDbPolicy-${var.aws_region}-${var.clumio_token}",
                    "path": "${var.path}",
                    "policy": "${data.aws_iam_policy_document.clumio_dynamodb_policy_document.json}"
                }
            }
        },
        {
            "aws_iam_policy": {
                "clumio_ec2_mssql_protect_policy": {
                    "count": "${var.is_ec2_mssql_enabled ? 1 : 0}",
                    "name": "ClumioEC2MSSQLProtectPolicy-${var.aws_region}-${var.clumio_token}",
                    "path": "${var.path}",
                    "policy": "${data.aws_iam_policy_document.clumio_ec2_mssql_protect_policy_document[0].json}"
                }
            }
        },
        {
            "aws_iam_policy": {
                "clumio_ec2_protect_managed_policy": {
                    "count": "${var.is_ebs_enabled ? 1 : 0}",
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "name": "ClumioEC2ProtectManagedPolicy-${var.aws_region}-${var.clumio_token}",
                    "path": "${var.path}",
                    "policy": "${data.aws_iam_policy_document.clumio_ec2_protect_managed_policy_document.json}"
                }
            }
        },
        {
            "aws_iam_policy": {
                "clumio_iam_permissions_boundary": {
                    "count": "${var.is_dynamodb_enabled ? 1 : 0}",
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "description": "Enforces a permissions boundary for roles created by Clumio.",
                    "name": "ClumioIAMPermissionsBoundary-${var.aws_region}-${var.clumio_token}",
                    "path": "${var.path}",
                    "policy": "${data.aws_iam_policy_document.clumio_iam_permissions_boundary_document[0].json}"
                }
            }
        },
        {
            "aws_iam_policy": {
                "clumio_iam_role_policy": {
                    "count": "${var.is_dynamodb_enabled ? 1 : 0}",
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "name": "ClumioIAMRolePolicy-${var.aws_region}-${var.clumio_token}",
                    "policy": "${data.aws_iam_policy_document.clumio_iam_role_policy_document[0].json}"
                }
            }
        },
        {
            "aws_iam_policy": {
                "clumio_kms_managed_policy": {
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "name": "ClumioKMSManagedPolicy-${var.aws_region}-${var.clumio_token}",
                    "path": "${var.path}",
                    "policy": "${data.aws_iam_policy_document.clumio_kms_managed_policy_document.json}"
                }
            }
        },
        {
            "aws_iam_policy": {
                "clumio_s3_continuous_backup_event_bridge_policy": {
                    "count": "${var.is_s3_enabled ? 1 : 0}",
                    "name": "ClumioS3EbPolicy-${var.aws_account_id}-${var.aws_region}-${var.clumio_token}",
                    "policy": "${data.aws_iam_policy_document.clumio_s3_continuous_backup_event_bridge_policy_document.json}"
                }
            }
        },
        {
            "aws_iam_policy": {
                "clumio_s3_protect_policy": {
                    "count": "${var.is_s3_enabled ? 1 : 0}",
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "description": "Grants access to Clumio for S3 protection",
                    "name": "ClumioS3ProtectPolicy-${var.aws_region}-${var.clumio_token}",
                    "path": "${var.path}",
                    "policy": "${data.aws_iam_policy_document.clumio_s3_protect_policy_document[0].json}"
                }
            }
        },
        {
            "aws_iam_policy": {
                "clumio_warm_protect_dynamodb_policy": {
                    "count": "${var.is_dynamodb_enabled ? 1 : 0}",
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "description": "Grants access to Clumio for DynamoDB warm-tier protection.",
                    "name": "ClumioWarmProtectDynamoDbPolicy-${var.aws_region}-${var.clumio_token}",
                    "path": "${var.path}",
                    "policy": "${data.aws_iam_policy_document.clumio_warm_protect_dynamodb_policy_document.json}"
                }
            }
        },
        {
            "aws_iam_role": {
                "clumio_ec2_mssql_ssm_instance_role_v2": {
                    "assume_role_policy": "${data.aws_iam_policy_document.clumio_ec2_mssql_ssm_instance_role_v2_document.json}",
                    "count": "${var.is_ec2_mssql_enabled ? 1 : 0}",
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "name": "ClumioSSM-${var.aws_region}-${var.clumio_token}",
                    "path": "${var.path}",
                    "permissions_boundary": "${var.permissions_boundary_arn}",
                    "tags": "${var.clumio_iam_role_tags}"
                }
            }
        },
        {
            "aws_iam_role": {
                "clumio_iam_role": {
                    "assume_role_policy": "${data.aws_iam_policy_document.aws_iam_role_document.json}",
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "name": "ClumioRole-${var.aws_region}-${var.clumio_token}",
                    "path": "${var.path}",
                    "permissions_boundary": "${var.permissions_boundary_arn}",
                    "tags": "${var.clumio_iam_role_tags}"
                }
            }
        },
        {
            "aws_iam_role": {
                "clumio_s3_continuous_backup_event_bridge_role": {
                    "assume_role_policy": "${data.aws_iam_policy_document.clumio_s3_continuous_backup_event_bridge_role_document.json}",
                    "count": "${var.is_s3_enabled ? 1 : 0}",
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "name": "ClumioS3EbRole-${lookup(local.region_map, var.aws_region, \"\")}-${var.clumio_token}",
                    "path": "${var.path}",
                    "permissions_boundary": "${var.permissions_boundary_arn}",
                    "tags": "${var.clumio_iam_role_tags}"
                }
            }
        },
        {
            "aws_iam_role": {
                "clumio_ssm_notification_role": {
                    "assume_role_policy": "${data.aws_iam_policy_document.clumio_ssm_notification_role_document.json}",
                    "count": "${var.is_ec2_mssql_enabled ? 1 : 0}",
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "name": "ClumioSSMNotifRole-${lookup(local.region_map, var.aws_region, \"\")}-${var.clumio_token}",
                    "path": "${var.path}",
                    "permissions_boundary": "${var.permissions_boundary_arn}",
                    "tags": "${var.clumio_iam_role_tags}"
                }
            }
        },
        {
            "aws_iam_role": {
                "clumio_support_role": {
                    "assume_role_policy": "${data.aws_iam_policy_document.aws_support_role_document.json}",
                    "count": "1",
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "name": "ClumioSuppt-${var.aws_region}-${var.clumio_token}",
                    "path": "${var.path}",
                    "permissions_boundary": "${var.permissions_boundary_arn}",
                    "tags": "${var.clumio_iam_role_tags}"
                }
            }
        },
        {
            "aws_iam_role_policy_attachment": {
                "clumio_ec2_mssql_protect_policy_role_attachment": {
                    "count": "${var.is_ec2_mssql_enabled ? 1 : 0}",
                    "policy_arn": "${aws_iam_policy.clumio_ec2_mssql_protect_policy[0].arn}",
                    "role": "${aws_iam_role.clumio_iam_role.name}"
                }
            }
        },
        {
            "aws_iam_role_policy_attachment": {
                "clumio_iam_role_clumio_discover_policy_attachment": {
                    "policy_arn": "${aws_iam_policy.clumio_discover_policy.arn}",
                    "role": "${aws_iam_role.clumio_iam_role.name}"
                }
            }
        },
        {
            "aws_iam_role_policy_attachment": {
                "clumio_iam_role_clumio_dynamodb_policy_attachment": {
                    "count": "${var.is_dynamodb_enabled ? 1 : 0}",
                    "policy_arn": "${aws_iam_policy.clumio_dynamodb_policy[0].arn}",
                    "role": "${aws_iam_role.clumio_iam_role.name}"
                }
            }
        },
        {
            "aws_iam_role_policy_attachment": {
                "clumio_iam_role_clumio_ec2_protect_managed_policy_attachment": {
                    "count": "${var.is_ebs_enabled ? 1 : 0}",
                    "policy_arn": "${aws_iam_policy.clumio_ec2_protect_managed_policy[0].arn}",
                    "role": "${aws_iam_role.clumio_iam_role.name}"
                }
            }
        },
        {
            "aws_iam_role_policy_attachment": {
                "clumio_iam_role_clumio_kms_managed_policy_attachment": {
                    "policy_arn": "${aws_iam_policy.clumio_kms_managed_policy.arn}",
                    "role": "${aws_iam_role.clumio_iam_role.name}"
                }
            }
        },
        {
            "aws_iam_role_policy_attachment": {
                "clumio_iam_role_clumio_s3_protect_policy_attachment": {
                    "count": "${var.is_s3_enabled ? 1 : 0}",
                    "depends_on": [
                        "time_sleep.wait_5_seconds_for_clumio_s3_protect_policy"
                    ],
                    "policy_arn": "${aws_iam_policy.clumio_s3_protect_policy[0].arn}",
                    "role": "${aws_iam_role.clumio_iam_role.name}"
                }
            }
        },
        {
            "aws_iam_role_policy_attachment": {
                "clumio_iam_role_clumio_warm_protect_dynamodb_policy_attachment": {
                    "count": "${var.is_dynamodb_enabled ? 1 : 0}",
                    "policy_arn": "${aws_iam_policy.clumio_warm_protect_dynamodb_policy[0].arn}",
                    "role": "${aws_iam_role.clumio_iam_role.name}"
                }
            }
        },
        {
            "aws_iam_role_policy_attachment": {
                "clumio_iam_role_policy_attachment": {
                    "count": "${var.is_dynamodb_enabled ? 1 : 0}",
                    "policy_arn": "${aws_iam_policy.clumio_iam_role_policy[0].arn}",
                    "role": "${aws_iam_role.clumio_iam_role.name}"
                }
            }
        },
        {
            "aws_iam_role_policy_attachment": {
                "clumio_s3_continuous_backup_event_bridge_role_policy_attachment": {
                    "count": "${var.is_s3_enabled ? 1 : 0}",
                    "policy_arn": "${aws_iam_policy.clumio_s3_continuous_backup_event_bridge_policy[0].arn}",
                    "role": "${aws_iam_role.clumio_s3_continuous_backup_event_bridge_role[0].name}"
                }
            }
        },
        {
            "aws_iam_role_policy": {
                "clumio_base_policy": {
                    "name": "ClumioBasePolicy-${var.aws_region}-${var.clumio_token}",
                    "policy": "${data.aws_iam_policy_document.clumio_base_policy_document.json}",
                    "role": "${aws_iam_role.clumio_iam_role.id}"
                }
            }
        },
        {
            "aws_iam_role_policy": {
                "clumio_drift_detect_policy": {
                    "name": "ClumioDriftDetectPolicy-${var.aws_region}-${var.clumio_token}",
                    "policy": "${data.aws_iam_policy_document.clumio_drift_detect_policy_document.json}",
                    "role": "${aws_iam_role.clumio_iam_role.id}"
                }
            }
        },
        {
            "aws_iam_role_policy": {
                "clumio_ec2_mssql_ssm_instance_policy": {
                    "count": "${var.is_ec2_mssql_enabled ? 1 : 0}",
                    "name": "Clumio-SSM-Policy-${var.aws_region}-${var.clumio_token}",
                    "policy": "${data.aws_iam_policy_document.clumio_ec2_mssql_ssm_instance_policy_document.json}",
                    "role": "${aws_iam_role.clumio_ec2_mssql_ssm_instance_role_v2[0].id}"
                }
            }
        },
        {
            "aws_iam_role_policy": {
                "clumio_rds_protect_policy": {
                    "count": "${var.is_rds_enabled ? 1 : 0}",
                    "name": "ClumioRdsProtectPolicy-${var.aws_region}-${var.clumio_token}",
                    "policy": "${data.aws_iam_policy_document.clumio_rds_protect_policy_document.json}",
                    "role": "${aws_iam_role.clumio_iam_role.id}"
                }
            }
        },
        {
            "aws_iam_role_policy": {
                "clumio_ssm_notification_policy": {
                    "count": "${var.is_ec2_mssql_enabled ? 1 : 0}",
                    "name": "ClumioSSMNotificationPolicy-${var.aws_account_id}-${var.aws_region}-${var.clumio_token}",
                    "policy": "${data.aws_iam_policy_document.clumio_ssm_notification_policy_document.json}",
                    "role": "${aws_iam_role.clumio_ssm_notification_role[0].id}"
                }
            }
        },
        {
            "aws_iam_role_policy": {
                "clumio_support_policy": {
                    "count": "1",
                    "name": "ClumioSupportPolicy-${var.aws_region}-${var.clumio_token}",
                    "policy": "${data.aws_iam_policy_document.clumio_support_policy_document.json}",
                    "role": "${aws_iam_role.clumio_support_role[0].id}"
                }
            }
        },
        {
            "aws_sns_topic": {
                "clumio_event_pub": {
                    "depends_on": [
                        "time_sleep.wait_before_create"
                    ],
                    "display_name": "Clumio Inventory Topic",
                    "name": "ClumioInventoryTopic_${var.clumio_token}"
                }
            }
        },
        {
            "aws_sns_topic_policy": {
                "clumio_event_pub_policy": {
                    "arn": "${aws_sns_topic.clumio_event_pub.arn}",
                    "policy": "${data.aws_iam_policy_document.clumio_event_pub_policy_document.json}"
                }
            }
        },
        {
            "clumio_post_process_aws_connection": {
                "clumio_callback": {
                    "account_id": "${var.aws_account_id}",
                    "clumio_event_pub_id": "${aws_sns_topic.clumio_event_pub.arn}",
                    "config_version": "${var.access_via_role_chaining ? \"2.5\" : \"2.4\"}",
                    "depends_on": [
                        "aws_iam_role.clumio_iam_role",
                        "time_sleep.wait_30_seconds_for_iam_propagation",
                        "aws_iam_role_policy.clumio_base_policy",
                        "aws_iam_role_policy.clumio_drift_detect_policy",
                        "aws_iam_policy.clumio_discover_policy",
                        "aws_iam_policy.clumio_kms_managed_policy",
                        "aws_cloudwatch_event_target.clumio_tag_event_rule_target",
                        "aws_iam_policy.clumio_dynamodb_policy",
                        "aws_iam_policy.clumio_warm_protect_dynamodb_policy",
                        "aws_cloudwatch_event_target.clumio_dynamo_cloudtrail_event_rule_target",
                        "aws_cloudwatch_event_target.clumio_ebs_cloudwatch_event_rule_target",
                        "aws_cloudwatch_event_target.clumio_ebs_cloudtrail_event_rule_target",
                        "aws_cloudwatch_event_target.clumio_ec2_cloudwatch_event_rule_target",
                        "aws_cloudwatch_event_target.clumio_ec2_cloudtrail_event_rule_target",
                        "aws_cloudwatch_event_target.clumio_rds_cloudwatch_event_rule_target",
                        "aws_cloudwatch_event_target.clumio_rds_cloudtrail_event_rule_target",
                        "aws_iam_policy.clumio_ec2_mssql_protect_policy",
                        "aws_iam_instance_profile.clumio_ec2_mssql_ssm_instance_profile",
                        "aws_iam_role.clumio_ec2_mssql_ssm_instance_role_v2",
                        "aws_iam_role_policy.clumio_ec2_mssql_ssm_instance_policy",
                        "aws_iam_role.clumio_ssm_notification_role",
                        "aws_iam_role_policy.clumio_ssm_notification_policy",
                        "aws_iam_policy.clumio_s3_protect_policy",
                        "aws_cloudwatch_event_target.clumio_s3_cloudtrail_event_rule_target",
                        "aws_iam_role.clumio_s3_continuous_backup_event_bridge_role",
                        "aws_iam_policy.clumio_s3_continuous_backup_event_bridge_policy"
                    ],
                    "discover_version": "4.2",
                    "intermediate_role_arn": "${var.access_via_role_chaining ? lookup(local.clumio_iam_role_principal, \"intermediate_role\", \"\") : \"\"}",
                    "properties": {
                        "ClumioSSMNotificationRoleArn": "${var.is_ec2_mssql_enabled ? aws_iam_role.clumio_ssm_notification_role[0].arn : \"\"}",
                        "DynamoDbSecureVaultPolicyArn": "${var.is_dynamodb_enabled ? aws_iam_policy.clumio_dynamodb_policy[0].arn : \"\"}",
                        "DynamoDbWarmProtectPolicyArn": "${var.is_dynamodb_enabled ? aws_iam_policy.clumio_warm_protect_dynamodb_policy[0].arn : \"\"}",
                        "PermissionsBoundaryArn": "${var.is_dynamodb_enabled ? aws_iam_policy.clumio_iam_permissions_boundary[0].arn : \"\"}",
                        "ClumioS3ContinuousBackupEventBridgeRoleArn": "${var.is_s3_enabled ? aws_iam_role.clumio_s3_continuous_backup_event_bridge_role[0].arn : \"\"}"
                    },
                    "protect_config_version": "${var.access_via_role_chaining ? \"20.3\" : \"20.2\"}",
                    "protect_dynamodb_version": "${var.is_dynamodb_enabled ? \"5.0\" : \"\"}",
                    "protect_ebs_version": "${var.is_ebs_enabled ? \"21.0\" : \"\"}",
                    "protect_ec2_mssql_version": "${var.is_ec2_mssql_enabled ? \"2.3\" : \"\"}",
                    "protect_rds_version": "${var.is_rds_enabled ? \"18.3\" : \"\"}",
                    "protect_s3_version": "${var.is_s3_enabled ? \"4.3\" : \"\"}",
                    "protect_warm_tier_dynamodb_version": "${var.is_dynamodb_enabled? \"3.3\" : \"\"}",
                    "protect_warm_tier_version": "${var.is_dynamodb_enabled ? \"1.1\" : \"\"}",
                    "region": "${var.aws_region}",
                    "role_arn": "${aws_iam_role.clumio_iam_role.arn}",
                    "role_external_id": "${var.role_external_id}",
                    "token": "${var.clumio_token}"
                }
            }
        },
        {
            "time_sleep": {
                "wait_10_seconds_before_creating_clumio_s3_cloudtrail_event_rule": {
                    "count": "${var.is_s3_enabled ? 1 : 0}",
                    "create_duration": "10s"
                }
            }
        },
        {
            "time_sleep": {
                "wait_30_seconds_for_iam_propagation": {
                    "create_duration": "30s",
                    "depends_on": [
                        "aws_iam_role.clumio_iam_role"
                    ]
                }
            }
        },
        {
            "time_sleep": {
                "wait_5_seconds_for_clumio_s3_protect_policy": {
                    "count": "${var.is_s3_enabled ? 1 : 0}",
                    "create_duration": "5s",
                    "depends_on": [
                        "aws_iam_policy.clumio_s3_protect_policy"
                    ]
                }
            }
        },
        {
            "time_sleep": {
                "wait_before_create": {
                    "create_duration": "${var.wait_time_before_create}"
                }
            }
        }
    ]
}
